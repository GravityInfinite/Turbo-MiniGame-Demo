function isNumber(e){return"number"==typeof e?0==e-e:"string"==typeof e&&""!==e.trim()&&(Number.isFinite?Number.isFinite(+e):isFinite(+e))}var baseurl="https://turbo.api.plutus-cat.com/event_center/api/v1",header={"content-type":"application/json"},globalData={access_token:"",client_id:""},turbo={};function getQuery(){return wx.getLaunchOptionsSync().query||{}}function getPlatForm(){var e=getQuery();return e.ksUnitId||e.ksCampaignId||e.ksChannel?"kuaishou":e.clue_token||e.ad_id||e.creative_id||e.request_id||e.advertiser_id?"bytedance":""}function globalChecked(){if(!globalData.access_token)throw new Error("access_token is missing, you must call init first.");if(!globalData.client_id)throw new Error("client_id is missing, you must call init first.")}turbo.init=function(e="",t=""){if(!e)throw new Error("access_token must be required.");if(!t)throw new Error("client_id must be required.");globalData.access_token=e,globalData.client_id=t},turbo.register=function(e={}){if(globalChecked(),!e?.name)throw new Error("name must be required");if(!e?.channel)throw new Error("channel must be required");if(!e?.version&&0!==e?.version)throw new Error("version must be required");var t,n;if(isNumber(e?.version)&&"number"==typeof e?.version)return t=getPlatForm(),n={client_id:globalData.client_id,name:e.name,channel:e.channel,version:e.version,media_type:t||"tencent",wx_openid:e?.wx_openid||"",wx_unionid:e?.wx_unionid||"",click_id:e?.click_id||"",ad_data:{}},e=getQuery(),"kuaishou"===t?n.ad_data={callback:e?.callback||"",ksCampaignId:e?.ksCampaignId||"",ksUnitId:e?.ksUnitId||"",ksCreativeId:e?.ksCreativeId||"",ksChannel:e?.ksChannel||""}:"bytedance"===t&&(n.ad_data={clue_token:e?.clue_token||"",ad_id:e?.ad_id||"",creative_id:e?.creative_id||"",advertiser_id:e?.advertiser_id||"",request_id:e?.request_id||""}),new Promise(function(t,r){wx.request({url:baseurl+"/user/register/?access_token="+globalData.access_token,method:"POST",header:header,data:n,success(e){t(e)},fail(e){r(e)}})});throw new Error("version must be type: Number")},turbo.updateData=function(e={}){globalChecked();var n=getPlatForm();return new Promise(function(t,r){wx.request({url:`${baseurl}/user/update_data/?access_token=${globalData.access_token}&client_id=`+globalData.client_id,method:"POST",header:header,data:{click_id:e?.click_id||"",wx_openid:e?.wx_openid||"",media_type:n||e?.media_type||"tencent",wx_unionid:e?.wx_unionid||""},success(e){t(e)},fail(e){r(e)}})})},turbo.handleEvent=function(e={}){var n;if(globalChecked(),e?.event_type)return n={event_type:e?.event_type||""},e?.properties&&(n.properties=e?.properties),e?.timestamp&&(n.timestamp=e?.timestamp),new Promise(function(t,r){wx.request({url:`${baseurl}/event/handle_event/?access_token=${globalData.access_token}&client_id=`+globalData.client_id,method:"POST",header:header,data:n,success(e){t(e)},fail(e){r(e)}})});throw new Error("event_type must be required")},turbo.consumerEvent=function(e={}){if(globalChecked(),!e?.event_type)throw new Error("event_type must be required");if(!e?.ts&&0!==e?.ts)throw new Error("ts must be required");var n;if(isNumber(e?.ts))return n={event_type:e?.event_type,ts:e?.ts},e?.amount&&(n.amount=e?.amount),e?.real_amount&&(n.real_amount=e?.real_amount),new Promise(function(t,r){wx.request({url:`${baseurl}/event/consumer_event/?access_token=${globalData.access_token}&client_id=`+globalData.client_id,method:"POST",header:header,data:n,success(e){t(e)},fail(e){r(e)}})});throw new Error("ts must be type: Number")},module.exports=turbo;